CREATE TABLE subscription (id SERIAL NOT NULL, tarif_id INT NOT NULL, name VARCHAR(255) NOT NULL, start_date DATE NOT NULL, end_date DATE NOT NULL, is_active BOOLEAN NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_A3C664D3357C0A59 ON subscription (tarif_id);
COMMENT ON COLUMN subscription.start_date IS '(DC2Type:date_immutable)';
COMMENT ON COLUMN subscription.end_date IS '(DC2Type:date_immutable)';
CREATE TABLE item (id SERIAL NOT NULL, recipe_id INT DEFAULT NULL, type VARCHAR(255) NOT NULL, name VARCHAR(255) NOT NULL, quantity INT NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_1F1B251E59D8A214 ON item (recipe_id);
CREATE TABLE school (id SERIAL NOT NULL, address_id INT NOT NULL, name VARCHAR(255) NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_F99EDABBF5B7AF75 ON school (address_id);
CREATE TABLE invoice (id SERIAL NOT NULL, payement_id INT NOT NULL, reference VARCHAR(255) NOT NULL, total_ht NUMERIC(10, 2) NOT NULL, total_ttc NUMERIC(10, 2) NOT NULL, created_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_90651744868C0609 ON invoice (payement_id);
COMMENT ON COLUMN invoice.created_at IS '(DC2Type:datetime_immutable)';
CREATE TABLE "order" (id SERIAL NOT NULL, cart_id INT NOT NULL, reference VARCHAR(50) NOT NULL, validate_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL, status VARCHAR(255) NOT NULL, total_amount VARCHAR(255) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_F52993981AD5CDBF ON "order" (cart_id);
COMMENT ON COLUMN "order".validate_at IS '(DC2Type:datetime_immutable)';
CREATE TABLE recipe (id SERIAL NOT NULL, title VARCHAR(255) NOT NULL, description VARCHAR(255) NOT NULL, image_url VARCHAR(255) NOT NULL, PRIMARY KEY(id));
CREATE TABLE recipe_ingredient (id SERIAL NOT NULL, recipe_id INT NOT NULL, ingredient_id INT NOT NULL, quantity DOUBLE PRECISION NOT NULL, unit VARCHAR(255) DEFAULT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_22D1FE1359D8A214 ON recipe_ingredient (recipe_id);
CREATE INDEX IDX_22D1FE13933FE08C ON recipe_ingredient (ingredient_id);
CREATE TABLE cart_item (id SERIAL NOT NULL, item_id INT NOT NULL, cart_id INT NOT NULL, type VARCHAR(255) NOT NULL, quantity INT NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_F0FE2527126F525E ON cart_item (item_id);
CREATE INDEX IDX_F0FE25271AD5CDBF ON cart_item (cart_id);
CREATE TABLE "user" (id SERIAL NOT NULL, subsciption_id INT DEFAULT NULL, school_id INT DEFAULT NULL, first_name VARCHAR(255) NOT NULL, last_name VARCHAR(255) NOT NULL, username VARCHAR(255) NOT NULL, email VARCHAR(255) NOT NULL, password VARCHAR(255) NOT NULL, roles JSON NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_8D93D649E7927C74 ON "user" (email);
CREATE INDEX IDX_8D93D6494BC02993 ON "user" (subsciption_id);
CREATE INDEX IDX_8D93D649C32A47EE ON "user" (school_id);
CREATE TABLE ingredient (id SERIAL NOT NULL, name VARCHAR(255) NOT NULL, category VARCHAR(255) NOT NULL, unit VARCHAR(255) NOT NULL, is_allergen BOOLEAN NOT NULL, PRIMARY KEY(id));
CREATE TABLE payment (id SERIAL NOT NULL, order_ref_id INT NOT NULL, stripe_session_id INT NOT NULL, payment_status VARCHAR(255) NOT NULL, amount NUMERIC(10, 2) NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_6D28840DE238517C ON payment (order_ref_id);
CREATE TABLE cart (id SERIAL NOT NULL, user_ref_id INT NOT NULL, created_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL, is_active BOOLEAN NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_BA388B744E55A94 ON cart (user_ref_id);
COMMENT ON COLUMN cart.created_at IS '(DC2Type:datetime_immutable)';
CREATE TABLE tarif (id SERIAL NOT NULL, name VARCHAR(255) NOT NULL, amount NUMERIC(10, 2) NOT NULL, PRIMARY KEY(id));
CREATE TABLE address (id SERIAL NOT NULL, street VARCHAR(255) NOT NULL, street_extra VARCHAR(255) DEFAULT NULL, postal_code VARCHAR(255) NOT NULL, city VARCHAR(255) NOT NULL, PRIMARY KEY(id));
ALTER TABLE subscription ADD CONSTRAINT FK_A3C664D3357C0A59 FOREIGN KEY (tarif_id) REFERENCES tarif (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE item ADD CONSTRAINT FK_1F1B251E59D8A214 FOREIGN KEY (recipe_id) REFERENCES recipe (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE school ADD CONSTRAINT FK_F99EDABBF5B7AF75 FOREIGN KEY (address_id) REFERENCES address (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE invoice ADD CONSTRAINT FK_90651744868C0609 FOREIGN KEY (payement_id) REFERENCES payment (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE "order" ADD CONSTRAINT FK_F52993981AD5CDBF FOREIGN KEY (cart_id) REFERENCES cart (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE recipe_ingredient ADD CONSTRAINT FK_22D1FE1359D8A214 FOREIGN KEY (recipe_id) REFERENCES recipe (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE recipe_ingredient ADD CONSTRAINT FK_22D1FE13933FE08C FOREIGN KEY (ingredient_id) REFERENCES ingredient (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE cart_item ADD CONSTRAINT FK_F0FE2527126F525E FOREIGN KEY (item_id) REFERENCES item (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE cart_item ADD CONSTRAINT FK_F0FE25271AD5CDBF FOREIGN KEY (cart_id) REFERENCES cart (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE "user" ADD CONSTRAINT FK_8D93D6494BC02993 FOREIGN KEY (subsciption_id) REFERENCES subscription (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE "user" ADD CONSTRAINT FK_8D93D649C32A47EE FOREIGN KEY (school_id) REFERENCES school (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE payment ADD CONSTRAINT FK_6D28840DE238517C FOREIGN KEY (order_ref_id) REFERENCES "order" (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE cart ADD CONSTRAINT FK_BA388B744E55A94 FOREIGN KEY (user_ref_id) REFERENCES "user" (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
